<%- include('../layouts/admin/adminHeader') %>


        <!-- Sidebar Start -->
        <div class="sidebar pe-4 pb-3">
            <nav class="navbar bg-secondary navbar-dark">
                <a href="index.html" class="navbar-brand mx-4 mb-3">
                    <h3 class="text-primary"><i class="fa fa-user-edit me-2"></i>DarkPan</h3>
                </a>
                <div class="d-flex align-items-center ms-4 mb-4">
                    <div class="position-relative">
                        <img class="rounded-circle" src="img/user.jpg" alt="" style="width: 40px; height: 40px;">
                        <div
                            class="bg-success rounded-circle border border-2 border-white position-absolute end-0 bottom-0 p-1">
                        </div>
                    </div>
                    <div class="ms-3">
                        <h6 class="mb-0">KRISHNAPRASAD</h6>
                        <span>Admin</span>
                    </div>
                </div>
                <div class="navbar-nav w-100">
                    <a href="/admin/dashboard" class="nav-item nav-link"><i
                            class="fa fa-tachometer-alt me-2"></i>Dashboard</a>

                    <a href="/admin/alluser" class="nav-item nav-link"><i class="fa fa-th me-2"></i>All User</a>
                    <div class="nav-item dropdown">
                        <a href="/admin/allproduct" class="nav-link dropdown-toggle "><i
                                class="far fa-file-alt me-2"></i>All Product</a>
                        <div class="dropdown-menu bg-transparent border-0">
                            <a href="/admin/addproduct" class="dropdown-item">Add Product</a>
                        </div>
                    </div>
                    <div class="nav-item dropdown">
                        <a href="/admin/category" class="nav-link dropdown-toggle "><i
                                class="far fa-file-alt me-2"></i>Category</a>
                        <div class="dropdown-menu bg-transparent border-0">
                            <a href="/admin/addcategory" class="dropdown-item">Add Category</a>
                        </div>
                    </div>

                    <a href="/admin/orders" class="nav-item nav-link "><i class="fa fa-th me-2"></i>Orders</a>

                    <div class="nav-item dropdown">
                        <a href="/admin/coupon" class="nav-link dropdown-toggle active " data-bs-toggle="dropdown"><i
                                class="far fa-file-alt me-2"></i>All Coupons</a>
                        <div class="dropdown-menu bg-transparent border-0">
                            <a href="/admin/addcoupon" class="dropdown-item">Add Coupon</a>
                        </div>
                    </div>

                    <div class="nav-item dropdown">
                        <a href="/admin/banner" class="nav-link dropdown-toggle" ><i
                                class="far fa-file-alt me-2"></i>All Banners</a>
                        <div class="dropdown-menu bg-transparent border-0">
                            <a href="/admin/addbanner" class="dropdown-item">Add Banner</a>
                        </div>
                    </div>

                    <div class="nav-item dropdown">
                        <a href="/admin/offer" class="nav-link dropdown-toggle  " ><i
                                class="far fa-file-alt me-2"></i>All Offers</a>
                        <div class="dropdown-menu bg-transparent border-0">
                            <a href="/admin/addOffer" class="dropdown-item">Add Offer</a>
                        </div>
                    </div>

                </div>
                
            </nav>
        </div>
        <!-- Sidebar End -->
        <%- include('../layouts/admin/adminNav') %>



            <div class="container-fluid pt-4 px-4">
                <div class="row g-4">
                    <div class="col-sm-12 col-xl-12">
                        <div class="bg-secondary rounded h-100 p-4">
                            <h6 class="mb-4">Coupons</h6>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th scope="col">Coupon Name</th>
                        <th scope="col">Coupon Code</th>
                        <th scope="col">Discount Amount</th>
                        <th scope="col">Min Amount</th>
                        <th scope="col">Coupon Description</th>
                        <th scope="col">Expiry Date</th>
                        <th>Edit</th>
                        <th>Delete</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% if (coupons && coupons.length > 0) { %>
                                        <% coupons.forEach((coupon) => { %>
                                            <tr>
                                                <td><%= coupon.couponName %></td>
                                                <td><%= coupon.couponCode %></td>
                                                <td><%= coupon.discountAmount %></td>
                                                <td><%= coupon.minAmount %></td>
                                                <td><%= coupon.couponDescription %></td>
                                                <td>
                                                    <% if (coupon.expiryDate) { %>
                                                        <%= coupon.expiryDate.toLocaleDateString('en-US', {
                                                            year: 'numeric',
                                                            month: 'short',
                                                            day: '2-digit'
                                                        }).replace(/\//g, '-') %>
                                                    <% } else { %>
                                                        Not published
                                                    <% } %>
                                                </td>
                                                <td>
                                                    <a class="btn btn-primary" href="/admin/editcoupon?id=<%= coupon._id %>">Edit</a>
                                
                                                </td>
                                                <td>
                                                    <button class="btn btn-primary" onclick="deletecoupon('<%= coupon._id %>')">Delete</button>
                                
                                                </td>
                                            </tr>
                                        <% }); %>
                                    <% } else { %>
                                        <tr>
                                            <td colspan="7">No Coupons found</td>
                                        </tr>
                                    <% } %>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    </div>
                    </div>

                    <%- include('../layouts/admin/footBar') %>
            </div>
                    <%- include('../layouts/admin/adminFooter') %>
          

            <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

            <script>
                function deletecoupon(couponId) {
                  Swal.fire({
                    title: 'Are you sure?',
                    text: 'You won\'t be able to revert this!',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, delete it!'
                  }).then((result) => {
                    if (result.isConfirmed) {
                      fetch(`/admin/deleteCoupon/${couponId}`, {
                        method: 'DELETE', // Change the method to 'DELETE'
                        headers: {
                          'Content-Type': 'application/json',
                        },
                      })
                      .then(response => {
                        if (!response.ok) {
                          throw new Error(`HTTP error! Status: ${response.status}`);
                        }
                        return response.json();
                
                      })
                      .then(data => {
                        window.location.reload()
                      })
                      .catch(error => {
                        console.error('Error:', error);
                        // Handle fetch errors
                      });
                    }
                  });
                }
                </script>
