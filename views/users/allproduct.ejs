<%- include('../layouts/user/userHeader') %>


    <div class="page-wrapper">
        <header class="header">
            <div class="header-top">
                <div class="container">


                    <div class="header-right">
                        <ul class="top-menu">
                            <li>
                                <a href="#">Links</a>
                                <ul>
                                    <li><a href="/login"><i class="icon-user"></i>Login</a></li>
                                </ul>
                            </li>
                        </ul><!-- End .top-menu -->
                    </div><!-- End .header-right -->
                </div><!-- End .container -->
            </div><!-- End .header-top -->

            <div class="header-middle sticky-header">
                <div class="container">
                    <div class="header-left">
                        <button class="mobile-menu-toggler">
                            <span class="sr-only">Toggle mobile menu</span>
                            <i class="icon-bars"></i>
                        </button>

                        <a href="index.html" class="logo">
                            <img src="../user/assets/images/logo.png" alt="Molla Logo" width="105" height="25">
                        </a>

                        <nav class="main-nav">
                            <ul class="menu sf-arrows">
                                <li class="megamenu-container ">
                                    <a href="/">Home</a>
                                </li>
                                <li class="megamenu-container active">
                                    <a href="/product">Shop</a>

                                </li>
                                <li>

                                    <a href="product.html">About</a>

                                </li>
                                <li hidden>
                                    <a href="#">Blog</a>
                                </li>
                                <li>
                                    <a href="#">Contact</a>
                                </li>

                            </ul><!-- End .menu -->
                        </nav><!-- End .main-nav -->
                    </div><!-- End .header-left -->

                    <div class="header-right">
                        <div class="header-search">
                            <a href="#" class="search-toggle" role="button" title="Search"><i
                                    class="icon-search"></i></a>
                            <form action="/searchProduct" method="post">
                                <div class="header-search-wrapper">
                                    <label for="search" class="sr-only">Search</label>
                                    <input type="search" class="form-control" name="search" id="Search"
                                        placeholder="Search in..." required>

                                </div><!-- End .header-search-wrapper -->
                            </form>
                        </div><!-- End .header-search -->

                        <div class="dropdown cart-dropdown">
                            <a href="/cart" class="dropdown-toggle" role="button" aria-haspopup="true"
                                aria-expanded="false" data-display="static">
                                <i class="icon-shopping-cart"></i>
                            </a>
                        </div><!-- End .cart-dropdown -->
                    </div><!-- End .header-right -->
                </div><!-- End .container -->
            </div><!-- End .header-middle -->
        </header><!-- End .header -->

        <main class="main">

            <style>
                .product-price {
                    font-size: 16px;
                    margin-bottom: 5px;
                }

                .original-price {
                    text-decoration: line-through;
                    color: #999;

                }

                .offer-price {
                    color: #f10d24;
                    font-weight: bold;
                    padding-left: 20px;
                }
            </style>



            <div class="page-content">
                <div class="container">
                    <div class="toolbox">
                        <div class="toolbox-left">
                            <a href="#" class="sidebar-toggler"><i class="icon-bars"></i>Filters</a>
                        </div><!-- End .toolbox-left -->


                        <div class="toolbox-right">
                            <div class="toolbox-sort">
                                <label for="sortby">Sort by:</label>
                                <div class="select-custom">
                                    <select name="sortby" id="sortby" class="form-control" onchange="updateSort(this)">
                                        <option value="/product?sort=default" <%=sortOption==='default' ? 'selected'
                                            : '' %>>Sort By</option>
                                        <option value="/product?sort=priceLowTohigh" <%=sortOption==='priceLowTohigh'
                                            ? 'selected' : '' %>>Low-High</option>
                                        <option value="/product?sort=2" <%=sortOption==='2' ? 'selected' : '' %>
                                            >High-Low</option>
                                        <option value="/product?sort=3" <%=sortOption==='3' ? 'selected' : '' %>>Name
                                        </option>
                                    </select>
                                </div>
                            </div><!-- End .toolbox-sort -->
                        </div><!-- End .toolbox-right -->






                        <div class="products" id="searchResultsContainer">
                            <div class="row">
                                <% filteredProducts.forEach((productData)=> { %>
                                    <div class="col-6 col-md-4 col-lg-4 col-xl-3">
                                        <div class="product">
                                            <figure class="product-media">
                                                <a href="/eachproduct?id=<%= productData._id %>">
                                                    <img src="/uploads/<%= productData.image[0] %>" alt="Product image"
                                                        class="product-image" style="width: 100%; height: 300px;">
                                                </a>
                                            </figure><!-- End .product-media -->

                                            <div class="product-body">
                                                <h3 class="product-title">
                                                    <a href="/eachproduct?id=<%= productData._id %>"><b>
                                                            <%= productData.name %>
                                                        </b></a>
                                                </h3><!-- End .product-title -->
                                                <div class="product-cat">
                                                    <a href="/eachproduct?id=<%= productData._id %>">
                                                        <%= productData.category.name %>
                                                    </a>
                                                </div><!-- End .product-cat -->
                                                <br>

                                                <div class="product-price ">
                                                    <% if (productData.offer || productData.category.offer) { %>
                                                        <div class="row">


                                                            <br>
                                                            <span class="original-price  " style="margin-left: 10px;">₹
                                                                <%= productData.price %>
                                                            </span>
                                                            <br><br>
                                                            <span class="offer-price">
                                                                <%= productData.offer ? productData.offer.discount :
                                                                    productData . category.offer.discount %> % Off
                                                            </span>


                                                        </div>
                                                        <span class="w-100" style="color: green;">₹<%= productData.offerprice %>
                                                                </span>

                                                        <% } else { %>
                                                            ₹<%= productData.price %>
                                                                <% } %>
                                                </div>
                                            </div><!-- End .product-body -->
                                        </div><!-- End .product -->
                                    </div><!-- End .col-md-4 -->
                                    <% }) %>
                            </div><!-- End .row -->
                        </div><!-- End .products -->




                        <div class="sidebar-filter-overlay"></div><!-- End .sidebar-filter-overlay -->
                        <aside class="sidebar-shop sidebar-filter">
                            <div class="sidebar-filter-wrapper">
                                <div class="widget widget-clean">
                                    <label><i class="icon-close"></i>Filters</label>
                                    <a href="/product">Clean All</a>
                                </div><!-- End .widget -->

                                <h3 class="widget-title">
                                    <a href="/product" role="button" aria-expanded="true" aria-controls="widget-1">
                                        All Category
                                    </a>
                                </h3><!-- End .widget-title -->



                                <% allcategory.forEach((productData)=> { %>

                                    <div class="collapse show" id="widget-<%= productData.id %>">
                                        <div class="widget-body">
                                            <div class="filter-item">
                                                <div>

                                                    <label " for=" cat-<%=productData.id %>"><a
                                                            href="/product?category=<%= productData._id%>">
                                                            <%= productData.name %>
                                                        </a></label>
                                                </div><!-- End .custom-checkbox -->
                                                <span class="item-count"></span>

                                            </div><!-- End .filter-item -->
                                        </div><!-- End .widget-body -->
                                    </div><!-- End .collapse -->
                                    <% }) %>






                            </div><!-- End .sidebar-filter-wrapper -->
                        </aside><!-- End .sidebar-filter -->
                    </div><!-- End .container -->
                </div><!-- End .page-content -->


        </main><!-- End .main -->

        <nav aria-label="Page navigation ">
            <ul class="pagination justify-content-center mt-4">
              <% if (currentPage> 1) { %>
                <li class="page-item">
                  <a class="page-link" href="/product?page=<%= currentPage - 1 %>"
                    aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                    <span class="sr-only">Previous</span>
                  </a>
                </li>
                <% } else { %>
                  <li class="page-item disabled">
                    <span class="page-link" aria-hidden="true">&laquo;</span>
                  </li>
                  <% } %>

                    <% for (let page=1; page <=totalPages; page++) { %>
                      <li class="page-item <%= currentPage === page ? 'active' : '' %>">
                        <a class="page-link" href="/product?page=<%= page %>">
                          <%= page %>
                        </a>
                      </li>
                      <% } %>

                        <!-- <li class="page-item-total">of <%= totalPages %></li> -->

                        <% if (currentPage < totalPages) { %>
                          <li class="page-item">
                            <a class="page-link" href="/product?page=<%= currentPage + 1 %>"
                              aria-label="Next">
                              <span aria-hidden="true">&raquo;</span>
                              <span class="sr-only">Next</span>
                            </a>
                          </li>
                          <% } else { %>
                            <li class="page-item disabled">
                              <span class="page-link" aria-hidden="true">&raquo;</span>
                            </li>
                            <% } %>
            </ul>
          </nav>

        <%- include('../layouts/user/mobileview') %>
        <%- include('../layouts/user/userfooter') %>




<script>
    function updateSort(selectElement) {
        const selectedValue = selectElement.value;
        window.location.href = selectedValue;
    }

    document.querySelector('form').addEventListener('submit', async function (event) {
        event.preventDefault();

        const searchInput = document.getElementById('Search');
        const searchValue = searchInput.value.trim(); // Trim to remove leading/trailing whitespaces

        try {
            if (searchValue) {
                const response = await fetch('/searchProduct', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ Search: searchValue }),
                });

                const data = await response.json();
                displaySearchResults(data.response);
            } else {
                clearSearchResults();
            }
        } catch (error) {
            console.error(error.message);
        }
    });

    function displaySearchResults(searchResults) {
        const searchResultsContainer = document.getElementById('searchResultsContainer');

        // Clear previous search results
        searchResultsContainer.innerHTML = '';

        // Create a row container to hold the products
        const rowContainer = document.createElement('div');
        rowContainer.className = 'row';

        // Iterate through the search results and create HTML elements for each product
        searchResults.forEach(productData => {
            const productElement = document.createElement('div');
            productElement.className = 'col-6 col-md-4 col-lg-4 col-xl-3';

            // Create the HTML structure for a product
            productElement.innerHTML = `
                    <div class="product">
                    <figure class="product-media">
                    <a href="/eachproduct?id=${productData._id}">
                    <img src="/uploads/${productData.image[0]}" alt="Product image" class="product-image" style="width: 100%; height: 300px;">
                    </a>
                    </figure>
                    <div class="product-body">
                    <h3 class="product-title">
                    <a href="/eachproduct?id=${productData._id}"><b>${productData.name}</b></a>
                    </h3>
                    <div class="product-cat">
                    <a href="/eachproduct?id=${productData._id}">${productData.category.name}</a>
                    </div>
                    <div class="product-price">
                    <!-- Add your price logic here -->
                    </div>
                  <div class="Description">
                   ${productData.description}
                    </div>
                   </div> 
                   </div> `;

            rowContainer.appendChild(productElement);
        });

        // Append the row container to the main results container
        searchResultsContainer.appendChild(rowContainer);
    }

    function clearSearchResults() {
        const searchResultsContainer = document.getElementById('searchResultsContainer');
        searchResultsContainer.innerHTML = '';
    }


</script>